## GPIO

*General Purpose Input Output* **通用输出输入口**

可以用来读取来自外部设备的输入信号，并控制与之连接的外部设备的输出状态。

可以用来驱动 LED、按键、蜂鸣器、模拟通讯协议输出时序

通过 **GPIO_InitTypeDef** 设置 端口Pin / 中断触发模式Mode / 速度Speed

**设置中断**：开启时钟、初始化配置、配置NVIC中断优先级、编写中断函数

**端口输出输入模式**：浮空输入 / 上拉输入 / 下拉输出 / 模拟输入 / 开漏输出 / 推挽输出 / 复用开漏输出 / 复用推挽输出，常用GPIO_Mode_IPU上拉输入与GPIO_Mode_Out_PP推挽输出

通过 GPIO端口映射 与 位操作 可以实现**多个GPIO的同时输入输出控制**

---

## 调试方式

- 串口调试：通过串口将调试信息发送到PC端
- 显示屏调试：将调试值输出到单片机直连的显示屏上
- Keil调试：通过Keil软件进行调试

---

## 中断

**定义**：在主程序运行过程中，出现了特定的中断触发条件（中断源），使得CPU暂停当前正在运行的程序，转而去处理中断程序，处理完成后又返回原来被暂停的位置继续运行

**NVIC**：中断优先级控制，中断信号由NVIC处理先后顺序后再交付CPU进行相应处理

**中断类型**：

- 外部中断（EXTI）
- DMA中断
- 定时器中断 TIM
- UART、SPI、I2C 串口/总线中断

**实战应用**：配置EXTI初始化、设置NVIC、编写相关中断函数

**IRQHandler介绍**：中断服务程序是中断处理的核心，它的正确和高效的编写对于系统的实时性和可靠性至关重要。在编写中断服务程序时，需要合理地处理中断事件，并尽可能地减少执行时间和占用系统资源，以确保系统的稳定运行。

**软件中断**：通过NVIC_SetPendingIRQ()

**中断的调试**：ST-Link调试器、串口输出、LED灯、仿真软件

---

## AFIO 

主要功能：复用功能引脚重映射、中断引脚选择

---

## TIM

**作用**：

- 计时 / 计数
- 产生定时中断信号
- PWM信号控制
- 产生输出比较事件

**时钟源**：*TIM_InternalClockConfig*内部时钟* / TIM_ETRClockMode2Config*外部时钟

**时基单元**：ARR自动重装器、PSC预分频器、CNT计数器

**实战应用**：TIM初始化、NVIC配置、使能TIM、编写中断函数

---

## PWM

**定义**：PWM信号是一种脉冲宽度调制信号，通过改变脉冲的宽度和周期来控制输出电平的平均值。在STM32中，可以使用TIM模块的输出比较模式和PWM输出模式来产生PWM信号。PWM信号在控制电机、LED、电器等方面有广泛的应用。

**实战应用**：

- - **输出**
  - 常规：配置TIM通道、配置TIM时钟源与分频系数、配置TIM输出模式(PWM模式)(OC)、使能TIM和设置对应输出GPIO，
  - DMA：使能TIM与DMA，设置相关值(CCR)、启动DMA传输
- - **输入**
  - 常规：设置带有OC的TIM后，再配置IC(input compare)，然后配置主从
  - PWMI：在常规的基础上设置一下PWMI，TIM_PWMIConfig

---

## ADC

**定义**：Analog-Digital Converter 模拟-数字转换器，讲引脚上变化的模拟信号转化为数据变量

**转换模式**：

- **单次** / **连续**：单次就是每次读一个，然后就没有然后了，连续就是读完后继续不断地读
- **扫描** / **非扫描**：非扫描就是只读一个，扫描就是每次都读设置的n个

**实战应用**：

- 常规：设置GPIO，设置ADC，ADC校准

- DMA：通过DMA将ADC接收的数据进行迁移，防止原数据被覆盖

---

## DMA

**定义**：Direct Memory Access，无须CPU控制进行数据迁移

**实战应用**：

- 普通数据迁移：配置DMA信息，特别是数据源地址、目的地址、迁移数据大小，使能DMA

- 与ADC配合使用，将ADC数据进行迁移

---

## USART

**定义**：universal synchronous/asynchronous receiver/transmitter，串口通信常用协议，可全双工通信

**实战应用**：

- 发送数据：开启 USART时钟，配置GPIO口，配置USART(Tx为发送/Rx为接收)，给USART口使能。通过Serial_SendData发数据，并用USART_GetFlagStatus判断USART_FLAG_TXE为SET则发送完毕
- 接收数据：在上述基础上，配置NVIC中断，编写中断函数进行数据接收处理
- 拓展：通过改写 int fputc(int ch,FILE *f) 改变 printf 行为
- 注意：如果发送过快或者读取不及时，会发生数据覆盖

---

## I2C

**定义**：Inter-Integrated Circuit，同步半双工，一般一主多从

**通信线**：

- **SCL**（Serial Clock）：用于控制设备同步时序
- **SDA**（Serial Data） ：传输数据

**传输数据**：（7Bit模式中，前7位为设备地址，最后一位为读写标志位)

- **软件**读写：

> **指定地址写**
>
> > 指定设备Slave Address，指定地址Reg Address，写入数据
> >
> > 开启 I2C，写设备地址，收应答，写寄存器地址，收应答，写数据，收应答，结束 I2C

> **当前地址读**

> **指定地址写**
>
> > 指定设备Slave Address，指定地址Reg Address，读取数据
> >
> > 开启 I2C，写设备地址，收应答，写寄存器地址，收应答，再次开启I2C，读寄存器地址，收应答，读数据，发应答，结束 I2C

  - **硬件**读写：

> 将软件的那些操作改为硬件接口，通过硬件库函数配合检测Event实现

***优缺点***：

- - **优点**：
  - **外设数量**：I2C总线可以连接多个外设，每个外设都有一个唯一的地址。
  - **速度**：I2C总线速度相对较慢，适合低速数据传输。
  - **简单性**：I2C总线只需要两条数据线进行通信，实现简单。

  

- - **缺点**：
  - **距离限制**：I2C总线的距离限制较短，适用于短距离通信。
  - **带宽**：I2C总线的带宽受限，适合小规模数据传输。
  - **实时性**：I2C总线不太适合实时性要求高的应用场景



---

## SPI

**定义**：Serial Peripheral Interface，同步全双工，一主多从，常用的串行通信接口，高速传输、低功耗、高可靠

**数据采集**：在SCK上升沿(下降沿)时，根据 MOSI / MISO 判断数据值

**通信线**：

- **SCK**（Serial Clock）：用于同步数据传输的时钟信号，频率越高，数据传输速度越快，噪声也功耗也越大
- **SS**（Slave Select）：用于选择从设备进行数据传输
- **MOSI**（Master Output Slave Input）：用于主设备传数据给从设备
- **MISO**（Master Input Slave Output）：用于从设备向主设备返回数据

**传输数据**：

- **流程**：通过交换 bit数据 实现数据传输，在移位寄存器上，将一位数据发出去，寄存器值右移一位，接收一位数据，同时在从设备的移位寄存器上也是相同操作
- **实现**：将数据最高位发出去，开SCK(1)，收一位数据，关SCK(0)

**优缺点**：

- - **优点**：
  - **速度**：SPI总线速度较快，适合高速数据传输。
  - **距离限制**：SPI总线的距离限制相对较长，适用于长距离通信。
  - **带宽**：SPI总线带宽相对较大，适合大规模数据传输。
  - **实时性**：SPI总线适合实时性要求高的应用场景。

  

- - **缺点**：
  - **外设数量**：SPI总线连接的外设数量有限。
  - **繁琐性**：SPI总线需要多条数据线进行通信，实现相对复杂。

